var e=Object.defineProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,l=(t,s,n)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[s]=n,a=(e,a)=>{for(var r in a||(a={}))s.call(a,r)&&l(e,r,a[r]);if(t)for(var r of t(a))n.call(a,r)&&l(e,r,a[r]);return e},r=(e,l)=>{var a={};for(var r in e)s.call(e,r)&&l.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&t)for(var r of t(e))l.indexOf(r)<0&&n.call(e,r)&&(a[r]=e[r]);return a};import{s as o,v as i,a as c,g as u,b as h,c as d,A as f}from"./index.92c54a80.js";import{c as p,_ as m}from"./CardComponent.0418067d.js";import{U as g,_ as v,G as y}from"./unit.ca89abd0.js";import{S as k}from"./SvgIcon.85a6de8b.js";import{a as w,g as C,_ as x,i as b,b as _,d as S,e as M,f as T,h as P,j as D,k as H,l as A,c as I}from"./cloneDeep.3fdd3a58.js";import{E,g as U,c as R,f as z,d as j,r as O}from"./types.69209817.js";import{d as L,N as B,u as F,v as N,x as V,L as G,J as q,K as W,Q as $,r as X,f as K,o as Y,c as J,a as Q,n as Z,t as ee,i as te,b as se,w as ne,e as le,F as ae,j as re,E as oe,k as ie,H as ce}from"./vendor.a60aa299.js";import{R as ue,d as he,G as de,e as fe}from"./common.44480256.js";import"./UnitComponent.fa4ae866.js";import"./vue-class-component.esm-bundler.47d45929.js";var pe={statCtn:"_statCtn_fk2wl_1",statIcon:"_statIcon_fk2wl_16",statValue:"_statValue_fk2wl_22",statsPanelCtn:"_statsPanelCtn_fk2wl_30",statsPanel:"_statsPanel_fk2wl_30",statCtnCounter:"_statCtnCounter_fk2wl_40",statCtnCrane:"_statCtnCrane_fk2wl_47",statCtnTrash:"_statCtnTrash_fk2wl_53",statCtnDirection:"_statCtnDirection_fk2wl_59",ctn:"_ctn_fk2wl_67",gamePanel:"_gamePanel_fk2wl_84",handPanelCtn:"_handPanelCtn_fk2wl_93",handPanel:"_handPanel_fk2wl_93",handPanelCard:"_handPanelCard_fk2wl_114",termPanel:"_termPanel_fk2wl_121",termSlot:"_termSlot_fk2wl_135",termCard:"_termCard_fk2wl_139",termGradient:"_termGradient_fk2wl_157",termGradient_empty:"_termGradient_empty_fk2wl_164",termGradient_select:"_termGradient_select_fk2wl_164",termCardCtn:"_termCardCtn_fk2wl_181",message:"_message_fk2wl_186",header:"_header_fk2wl_198",headerMessage:"_headerMessage_fk2wl_206",headerMessageText:"_headerMessageText_fk2wl_212",headerMessageTextCtn:"_headerMessageTextCtn_fk2wl_221",headerMessageTextRepeat:"_headerMessageTextRepeat_fk2wl_225",headerLinks:"_headerLinks_fk2wl_235",headerLink:"_headerLink_fk2wl_235",directionPopupCtn:"_directionPopupCtn_fk2wl_254",selectPopupCtn:"_selectPopupCtn_fk2wl_254",messagePopupCtn:"_messagePopupCtn_fk2wl_254",directionPopup:"_directionPopup_fk2wl_254",directionPopupTitle:"_directionPopupTitle_fk2wl_284",messagePopupTitle:"_messagePopupTitle_fk2wl_284",messagePopupText:"_messagePopupText_fk2wl_284",directionPopupChoose:"_directionPopupChoose_fk2wl_292",directionPopupDirection:"_directionPopupDirection_fk2wl_297",directionPopupIcon:"_directionPopupIcon_fk2wl_311",selectPopup:"_selectPopup_fk2wl_254",selectPopupCard:"_selectPopupCard_fk2wl_326",messagePopup:"_messagePopup_fk2wl_254",messagePopupButton:"_messagePopupButton_fk2wl_341"},me={exports:{}};!function(e,t,s){function n(e){var t,s=this,n=(t=4022871197,function(e){e=String(e);for(var s=0;s<e.length;s++){var n=.02519603282416938*(t+=e.charCodeAt(s));n-=t=n>>>0,t=(n*=t)>>>0,t+=4294967296*(n-=t)}return 2.3283064365386963e-10*(t>>>0)});s.next=function(){var e=2091639*s.s0+2.3283064365386963e-10*s.c;return s.s0=s.s1,s.s1=s.s2,s.s2=e-(s.c=0|e)},s.c=1,s.s0=n(" "),s.s1=n(" "),s.s2=n(" "),s.s0-=n(e),s.s0<0&&(s.s0+=1),s.s1-=n(e),s.s1<0&&(s.s1+=1),s.s2-=n(e),s.s2<0&&(s.s2+=1),n=null}function l(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function a(e,t){var s=new n(e),a=t&&t.state,r=s.next;return r.int32=function(){return 4294967296*s.next()|0},r.double=function(){return r()+11102230246251565e-32*(2097152*r()|0)},r.quick=r,a&&("object"==typeof a&&l(a,s),r.state=function(){return l(s,{})}),r}t&&t.exports?t.exports=a:this.alea=a}(0,me);var ge={exports:{}};!function(e,t,s){function n(e){var t=this,s="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:s+=e;for(var n=0;n<s.length+64;n++)t.x^=0|s.charCodeAt(n),t.next()}function l(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function a(e,t){var s=new n(e),a=t&&t.state,r=function(){return(s.next()>>>0)/4294967296};return r.double=function(){do{var e=((s.next()>>>11)+(s.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=s.next,r.quick=r,a&&("object"==typeof a&&l(a,s),r.state=function(){return l(s,{})}),r}t&&t.exports?t.exports=a:this.xor128=a}(0,ge);var ve={exports:{}};!function(e,t,s){function n(e){var t=this,s="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:s+=e;for(var n=0;n<s.length+64;n++)t.x^=0|s.charCodeAt(n),n==s.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function l(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function a(e,t){var s=new n(e),a=t&&t.state,r=function(){return(s.next()>>>0)/4294967296};return r.double=function(){do{var e=((s.next()>>>11)+(s.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=s.next,r.quick=r,a&&("object"==typeof a&&l(a,s),r.state=function(){return l(s,{})}),r}t&&t.exports?t.exports=a:this.xorwow=a}(0,ve);var ye={exports:{}};!function(e,t,s){function n(e){var t=this;t.next=function(){var e,s,n=t.x,l=t.i;return e=n[l],s=(e^=e>>>7)^e<<24,s^=(e=n[l+1&7])^e>>>10,s^=(e=n[l+3&7])^e>>>3,s^=(e=n[l+4&7])^e<<7,e=n[l+7&7],s^=(e^=e<<13)^e<<9,n[l]=s,t.i=l+1&7,s},function(e,t){var s,n=[];if(t===(0|t))n[0]=t;else for(t=""+t,s=0;s<t.length;++s)n[7&s]=n[7&s]<<15^t.charCodeAt(s)+n[s+1&7]<<13;for(;n.length<8;)n.push(0);for(s=0;s<8&&0===n[s];++s);for(8==s&&(n[7]=-1),e.x=n,e.i=0,s=256;s>0;--s)e.next()}(t,e)}function l(e,t){return t.x=e.x.slice(),t.i=e.i,t}function a(e,t){null==e&&(e=+new Date);var s=new n(e),a=t&&t.state,r=function(){return(s.next()>>>0)/4294967296};return r.double=function(){do{var e=((s.next()>>>11)+(s.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=s.next,r.quick=r,a&&(a.x&&l(a,s),r.state=function(){return l(s,{})}),r}t&&t.exports?t.exports=a:this.xorshift7=a}(0,ye);var ke={exports:{}};!function(e,t,s){function n(e){var t=this;t.next=function(){var e,s,n=t.w,l=t.X,a=t.i;return t.w=n=n+1640531527|0,s=l[a+34&127],e=l[a=a+1&127],s^=s<<13,e^=e<<17,s^=s>>>15,e^=e>>>12,s=l[a]=s^e,t.i=a,s+(n^n>>>16)|0},function(e,t){var s,n,l,a,r,o=[],i=128;for(t===(0|t)?(n=t,t=null):(t+="\0",n=0,i=Math.max(i,t.length)),l=0,a=-32;a<i;++a)t&&(n^=t.charCodeAt((a+32)%t.length)),0===a&&(r=n),n^=n<<10,n^=n>>>15,n^=n<<4,n^=n>>>13,a>=0&&(r=r+1640531527|0,l=0==(s=o[127&a]^=n+r)?l+1:0);for(l>=128&&(o[127&(t&&t.length||0)]=-1),l=127,a=512;a>0;--a)n=o[l+34&127],s=o[l=l+1&127],n^=n<<13,s^=s<<17,n^=n>>>15,s^=s>>>12,o[l]=n^s;e.w=r,e.X=o,e.i=l}(t,e)}function l(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function a(e,t){null==e&&(e=+new Date);var s=new n(e),a=t&&t.state,r=function(){return(s.next()>>>0)/4294967296};return r.double=function(){do{var e=((s.next()>>>11)+(s.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=s.next,r.quick=r,a&&(a.X&&l(a,s),r.state=function(){return l(s,{})}),r}t&&t.exports?t.exports=a:this.xor4096=a}(0,ke);var we={exports:{}};!function(e,t,s){function n(e){var t=this,s="";t.next=function(){var e=t.b,s=t.c,n=t.d,l=t.a;return e=e<<25^e>>>7^s,s=s-n|0,n=n<<24^n>>>8^l,l=l-e|0,t.b=e=e<<20^e>>>12^s,t.c=s=s-n|0,t.d=n<<16^s>>>16^l,t.a=l-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):s+=e;for(var n=0;n<s.length+20;n++)t.b^=0|s.charCodeAt(n),t.next()}function l(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function a(e,t){var s=new n(e),a=t&&t.state,r=function(){return(s.next()>>>0)/4294967296};return r.double=function(){do{var e=((s.next()>>>11)+(s.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},r.int32=s.next,r.quick=r,a&&("object"==typeof a&&l(a,s),r.state=function(){return l(s,{})}),r}t&&t.exports?t.exports=a:this.tychei=a}(0,we);var Ce,xe={exports:{}},be=C(Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:{}}));Ce=xe,function(e,t,s){var n,l=256,a=s.pow(l,6),r=s.pow(2,52),o=2*r,i=255;function c(i,c,m){var g=[],v=f(d((c=1==c?{entropy:!0}:c||{}).entropy?[i,p(t)]:null==i?function(){try{var s;return n&&(s=n.randomBytes)?s=s(l):(s=new Uint8Array(l),(e.crypto||e.msCrypto).getRandomValues(s)),p(s)}catch(o){var a=e.navigator,r=a&&a.plugins;return[+new Date,e,r,e.screen,p(t)]}}():i,3),g),y=new u(g),k=function(){for(var e=y.g(6),t=a,s=0;e<r;)e=(e+s)*l,t*=l,s=y.g(1);for(;e>=o;)e/=2,t/=2,s>>>=1;return(e+s)/t};return k.int32=function(){return 0|y.g(4)},k.quick=function(){return y.g(4)/4294967296},k.double=k,f(p(y.S),t),(c.pass||m||function(e,t,n,l){return l&&(l.S&&h(l,y),e.state=function(){return h(y,{})}),n?(s.random=e,t):e})(k,v,"global"in c?c.global:this==s,c.state)}function u(e){var t,s=e.length,n=this,a=0,r=n.i=n.j=0,o=n.S=[];for(s||(e=[s++]);a<l;)o[a]=a++;for(a=0;a<l;a++)o[a]=o[r=i&r+e[a%s]+(t=o[a])],o[r]=t;(n.g=function(e){for(var t,s=0,a=n.i,r=n.j,o=n.S;e--;)t=o[a=i&a+1],s=s*l+o[i&(o[a]=o[r=i&r+t])+(o[r]=t)];return n.i=a,n.j=r,s})(l)}function h(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function d(e,t){var s,n=[],l=typeof e;if(t&&"object"==l)for(s in e)try{n.push(d(e[s],t-1))}catch(a){}return n.length?n:"string"==l?e:e+"\0"}function f(e,t){for(var s,n=e+"",l=0;l<n.length;)t[i&l]=i&(s^=19*t[i&l])+n.charCodeAt(l++);return p(t)}function p(e){return String.fromCharCode.apply(0,e)}if(f(s.random(),t),Ce.exports){Ce.exports=c;try{n=be}catch(m){}}else s.seedrandom=c}("undefined"!=typeof self?self:w,[],Math);var _e=me.exports,Se=ge.exports,Me=ve.exports,Te=ye.exports,Pe=ke.exports,De=we.exports,He=xe.exports;He.alea=_e,He.xor128=Se,He.xorwow=Me,He.xorshift7=Te,He.xor4096=Pe,He.tychei=De;var Ae=He;class Ie{constructor(e,t,s,n,l){this.render=e,this.users=t,this.gameMap=s,this.seed=n,this.localUser=l,this.cardsDeck=[],this.cardsCount=96,this.cardsDefectCount=96,this.bombHP=8,this.roundCounter=0,this.killsCount=0,this.damageCardsDeck=[],this.isStarted=!1,this.random=Ae(n.toString()),this.render.renderMap(this.gameMap)}fillDeck(e,t,s){for(let n=0;n<s;n++)e.push(t[n%t.length].i);o(this.cardsDeck,this.random)}start(){if(this.isStarted)throw new Error("Game already started");this.isStarted=!0,this.render.updateBombCounter(this.bombHP);const e=p.map(((e,t)=>({c:e,i:t}))),t=e.filter((e=>e.c.type!==E.Defect));this.fillDeck(this.cardsDeck,t,this.cardsCount);const s=e.filter((e=>e.c.type===E.Defect));this.fillDeck(this.damageCardsDeck,s,this.cardsDefectCount),this.creepsSpawn();let n=this.gameMap.getAllCellsByType(U.Base).filter((e=>!e.hasUnit()));o(n,this.random);for(let a of this.users){const e=new g(R.Hero);let t=n.pop();if(!t)throw new Error("No place to unit");t.unit=e,a.myHero=e,e.ownerUser=a,this.render.initUnit(t),this.render.updateHeroDirection(t,a.myHero.direction)}const l=n.pop();if(!l)throw new Error("No place for bomb");l.unit=new g(R.Bomb),this.render.initUnit(l),setTimeout((()=>this.chooseCards()),0)}lose(e){this.render.stopSelect(),this.render.stopTimer(),this.render.defeat(e)}win(){this.render.stopSelect(),this.render.stopTimer(),this.render.win()}async chooseCards(){let e=this.users.length*(0===this.roundCounter?2:1);const t=e+1;if(this.cardsDeck.length<t)this.lose("lose.0");else{const s=this.cardsDeck.splice(0,t);for(let t=0;t<e;t++){if(0===s.length)return void this.lose("lose.0");{const e=t%this.users.length;this.render.showMessage(this.users[e].current?"message.0":"message.1");const n=await this.users[e].selectCard(s);s.splice(n,1)}}setTimeout((()=>this.programmingAct()),0)}}async programmingAct(){this.render.showMessage("message.2"),await Promise.all(this.users.map((e=>e.programming().then((()=>{e.current&&this.render.showMessage("message.3")}))))),setTimeout((()=>this.warriorsAct()),0)}async warriorsAct(){for(let e of this.users){this.render.showMessage(e.current?"message.4":"message.5");for(let t of e.stacks)await this.runStack(e,t)}setTimeout((()=>this.creepsMoveAct()),0)}async runStack(e,t){var s;let n=t.length;if(0===n)return;let l=t[n-1],a=p[l].levels[n-1],r=this.gameMap.getAllCellHasUnits(R.Hero).filter((t=>t.unit===e.myHero))[0];if(null==(s=null==a?void 0:a.rotate)?void 0:s.length){this.render.showMessage(e.current?"message.6":"message.7");const t=a.rotate[a.rotate.length>1?await e.chooseRotate(a.rotate,e.myHero.direction):0];e.myHero.rotate(t),this.render.updateHeroDirection(r,e.myHero.direction)}if(0!==a.move.length){let t=null;if(1===a.move.length)t=a.move[0];else{let s=[],n=[];for(let t of a.move){let l=i(t,e.myHero.direction),a=Math.max(Math.abs(l.x),Math.abs(l.y)),o={x:r.x+l.x,y:r.y-l.y};for(;;){let e=this.gameMap.getCell(o.x,o.y);if(o.x===r.x&&o.y===r.y)break;if(null!==e){s.push(e),n.push(t);break}o={x:o.x-l.x/a|0,y:o.y+l.y/a|0}}}if(0===n.length)t=null;else if(1===n.length)t=n[0];else{this.render.showMessage(e.current?"message.8":"message.9"),t=n[(await e.selectCells(s,z.Move,1))[0]]}}if(null!==t){let s=i(t,e.myHero.direction);await this.goRamming(e,r,s.x,-s.y)}}r=this.gameMap.getAllCellHasUnits(R.Hero).filter((t=>t.unit===e.myHero))[0],0!==a.attack.length&&await this.goAttack(e,r,a.attack,a.targetCount)}async goRamming(e,t,s,n){let l=[],a=[i({x:-1,y:0},t.unit.direction),i({x:0,y:-1},t.unit.direction),i({x:1,y:0},t.unit.direction)],r=null;for(const i of a){const e=this.gameMap.getCell(t.x+i.x,t.y-i.y);null===e||!e.hasUnit()||e.unit.type!==R.Hero&&e.unit.type!==R.Bomb||l.push(e)}l.push(t);let o=t.unit;l.length>1&&(this.render.showMessage(e.current?"message.10":"message.11"),r=l[(await e.selectCells(l,z.Hook,1))[0]],r!==t&&(t.unit.attachedCell=r));let u=t.x+s,h=t.y+n,d=Math.max(Math.abs(s),Math.abs(n)),f=[];f.push(t);let p=c(this.gameMap.size.x,this.gameMap.size.y);const m=[];for(;f.length;){const e=f.pop();if(!e)throw new Error("error");let t=this.gameMap.getCell(e.x+s/d|0,e.y+n/d|0);if(null===t||e.x===u&&e.y===h||1==p[t.x][t.y])p[e.x][e.y]=!0;else if(null===t.unit||t.unit.type!==R.Hero&&t.unit.type!==R.Bomb){if(null!==t.unit&&t.unit.type===R.Creep&&this.creepKill(t),m.push(this.render.moveUnit(e.unit,t)),this.gameMap.moveUnitFromCellToCoords(e,t.x,t.y),null!==t.unit.attachedCell){let s=t.unit.attachedCell;t.unit.attachedCell!==t&&s.unit&&(m.push(this.render.moveUnit(s.unit,e)),this.gameMap.moveUnitFromCellToCoords(s,e.x,e.y),t.unit.attachedCell=e)}this.render.showMessage("message.12"),f.push(t)}else f.push(e),f.push(t)}await Promise.all(m),await Promise.all(m),o.attachedCell=null}async goAttack(e,t,s,n){let l=[];for(let r of s){let e=i(r,t.unit.rotation),s=this.gameMap.getCell(e.x+t.x,t.y-e.y);null!==s&&null!==s.unit&&s.unit.type===R.Creep&&l.push(s)}let a=[];if(l.length>n){this.render.showMessage(e.current?"message.13":"message.14");let t=await e.selectCells(l,z.Attack,n);for(let e of t)a.push(l[e])}else a=l;for(let r of a)this.creepKill(r)}creepKill(e){this.render.killUnit(e),this.render.updateKillsCounter(++this.killsCount),e.killUnit()}async creepsMoveAct(){this.render.showMessage("message.15");let e=this.gameMap.getAllCellHasUnits(R.Creep),t=this.gameMap.getAllCellHasUnits(R.Bomb);const s=[];for(let n of e){let e=u(n,t[0]),l=this.gameMap.moveUnitFromCellToCoords(n,e.x,e.y);null!==l&&s.push(this.render.moveUnit(l.unit,l))}await Promise.all(s),setTimeout((()=>this.creepsSpawnAct()),0)}creepsSpawn(){let e=this.gameMap.getAllCellsByType(U.Runes).filter((e=>!e.hasUnit()));for(let t of e)t.hasUnit()||(t.unit=new g(R.Creep),this.render.initUnit(t))}creepsSpawnAct(){this.creepsSpawn(),setTimeout((()=>this.creepsAttackAct()),0)}creepsAttackAct(){let e=this.gameMap.getAllCellHasUnits(R.Bomb),t=this.gameMap.getAllCellHasUnits(R.Hero),s=[];for(let o of this.users){const e=t.find((e=>e.unit===o.myHero));if(!e)throw new Error("Impossible error");s.push(e)}let n=e.concat(s),l=[];const a=[[-1,0],[1,0],[0,-1],[0,1]];for(let o of n)for(let e of a){let t=this.gameMap.getCell(o.x+e[0],o.y+e[1]);null!==t&&null!==t.unit&&t.unit.type===R.Creep&&l.push({attacking:t,attacked:o})}const r=(e=0)=>{let t=l[e];if(t.attacked.unit.type===R.Hero)this.getDisable(t.attacked.unit.ownerUser);else if(t.attacked.unit.type===R.Bomb&&(this.render.updateBombCounter(--this.bombHP),0===this.bombHP))return void this.lose("lose.1");e+1<l.length?setTimeout((()=>r(e+1)),0):this.finalAct()};l.length>0?setTimeout((()=>r()),0):setTimeout((()=>this.finalAct()),0)}getDisable(e){if(0!==this.damageCardsDeck.length){let t=h(this.random,0,6);const s=this.damageCardsDeck.pop();e.stacks[t].length>0&&p[e.stacks[t][e.stacks[t].length-1]].type===E.Defect?(e.stacks[t].pop(),e.stacks[t].push(s)):e.stacks[t].push(s)}e.setStacks(e.stacks)}finalAct(){if(console.count("finalAct"),this.render.showMessage("message.16"),this.gameMap.getAllCellHasUnits(R.Bomb).find((e=>e.type!==U.Target))){const e=this.users.pop();void 0!==e&&this.users.unshift(e),this.roundCounter++,setTimeout((()=>this.chooseCards()),0)}else this.win()}}class Ee{}class Ue extends Ee{constructor(e,t,s){super(),this.network=e,this.id=t,this.render=s,this.chooseRotate=this.handlerFactory("chooseRotate"),this.programming=this.handlerFactory("programming"),this.selectCard=this.handlerFactory("selectCard"),this.selectCells=this.handlerFactory("selectCells"),this.selectStacks=this.handlerFactory("selectStacks"),this.setStacks=this.render.setStacks.bind(this.render),this.setHand=this.render.setHand.bind(this.render)}handlerFactory(e){return(...t)=>this.render[e](...t).then((async t=>(this.network&&await this.network.sendAction(e,t),t)))}}class Re extends Ee{constructor(e){super(),this.seed=e,this.random=Ae(e.toString())}setHand(e){}setStacks(e){}async selectCard(e){return 0}async programming(e){return[0,this.botAI(e,1)[0]]}async chooseRotate(e){return 0}async selectCells(e,t,s){return this.botAI(e,s)}async selectStacks(e,t){return this.botAI(e,t)}botAI(e,t){let s=[];for(let l=0;l<e.length;l++)s.push(l);o(s,this.random);let n=[];for(let l=0;l<t;l++)n[l]=s[l];return n}}var ze={},je=w&&w.__assign||function(){return(je=Object.assign||function(e){for(var t,s=1,n=arguments.length;s<n;s++)for(var l in t=arguments[s])Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l]);return e}).apply(this,arguments)},Oe=w&&w.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(l,a){function r(e){try{i(n.next(e))}catch(t){a(t)}}function o(e){try{i(n.throw(e))}catch(t){a(t)}}function i(e){var t;e.done?l(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}i((n=n.apply(e,t||[])).next())}))},Le=w&&w.__generator||function(e,t){var s,n,l,a,r={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(a){return function(o){return function(a){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,n&&(l=2&a[0]?n.return:a[0]?n.throw||((l=n.return)&&l.call(n),0):n.next)&&!(l=l.call(n,a[1])).done)return l;switch(n=0,l&&(a=[2&a[0],l.value]),a[0]){case 0:case 1:l=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,n=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(l=r.trys,(l=l.length>0&&l[l.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!l||a[1]>l[0]&&a[1]<l[3])){r.label=a[1];break}if(6===a[0]&&r.label<l[1]){r.label=l[1],l=a;break}if(l&&r.label<l[2]){r.label=l[2],r.ops.push(a);break}l[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(o){a=[6,o],n=0}finally{s=l=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,o])}}};function Be(e){var t=0,s=0,n=e;do{t+=n.offsetTop||0,s+=n.offsetLeft||0,n=n.offsetParent}while(n);return{top:t,left:s}}Object.defineProperty(ze,"__esModule",{value:!0});var Fe=function(){function e(e){this.element=e}return e.prototype.getHorizontalScroll=function(){return this.element.scrollLeft},e.prototype.getVerticalScroll=function(){return this.element.scrollTop},e.prototype.getMaxHorizontalScroll=function(){return this.element.scrollWidth-this.element.clientWidth},e.prototype.getMaxVerticalScroll=function(){return this.element.scrollHeight-this.element.clientHeight},e.prototype.getHorizontalElementScrollOffset=function(e,t){return Be(e).left-Be(t).left},e.prototype.getVerticalElementScrollOffset=function(e,t){return Be(e).top-Be(t).top},e.prototype.scrollTo=function(e,t){this.element.scrollLeft=e,this.element.scrollTop=t},e}(),Ne=function(){function e(){}return e.prototype.getHorizontalScroll=function(){return window.scrollX||document.documentElement.scrollLeft},e.prototype.getVerticalScroll=function(){return window.scrollY||document.documentElement.scrollTop},e.prototype.getMaxHorizontalScroll=function(){return Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.body.clientWidth,document.documentElement.clientWidth)-window.innerWidth},e.prototype.getMaxVerticalScroll=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)-window.innerHeight},e.prototype.getHorizontalElementScrollOffset=function(e){return(window.scrollX||document.documentElement.scrollLeft)+e.getBoundingClientRect().left},e.prototype.getVerticalElementScrollOffset=function(e){return(window.scrollY||document.documentElement.scrollTop)+e.getBoundingClientRect().top},e.prototype.scrollTo=function(e,t){window.scrollTo(e,t)},e}(),Ve={elements:[],cancelMethods:[],add:function(e,t){Ve.elements.push(e),Ve.cancelMethods.push(t)},remove:function(e,t){void 0===t&&(t=!0);var s=Ve.elements.indexOf(e);s>-1&&(t&&Ve.cancelMethods[s](),Ve.elements.splice(s,1),Ve.cancelMethods.splice(s,1))}},Ge="undefined"!=typeof window,qe={cancelOnUserAction:!0,easing:function(e){return--e*e*e+1},elementToScroll:Ge?window:null,horizontalOffset:0,maxDuration:3e3,minDuration:250,speed:500,verticalOffset:0};var We=ze.default=function(e,t){return void 0===t&&(t={}),Oe(this,void 0,void 0,(function(){var s,n,l,a,r,o,i,c,u,h,d,f,p,m,g,v,y;return Le(this,(function(k){if(!Ge)return[2,new Promise((function(e){e(!1)}))];if(!window.Promise)throw"Browser doesn't support Promises, and animated-scroll-to depends on it, please provide a polyfill.";if(a=je(je({},qe),t),r=a.elementToScroll===window,o=!!a.elementToScroll.nodeName,!r&&!o)throw"Element to scroll needs to be either window or DOM element.";if(i=r?document.documentElement:a.elementToScroll,"smooth"===getComputedStyle(i).getPropertyValue("scroll-behavior")&&console.warn(i.tagName+' has "scroll-behavior: smooth" which can mess up with animated-scroll-to\'s animations'),c=r?new Ne:new Fe(a.elementToScroll),e instanceof Element){if(l=e,o&&(!a.elementToScroll.contains(l)||a.elementToScroll.isSameNode(l)))throw"options.elementToScroll has to be a parent of scrollToElement";s=c.getHorizontalElementScrollOffset(l,a.elementToScroll),n=c.getVerticalElementScrollOffset(l,a.elementToScroll)}else if("number"==typeof e)s=c.getHorizontalScroll(),n=e;else{if(!Array.isArray(e)||2!==e.length)throw"Wrong function signature. Check documentation.\nAvailable method signatures are:\n  animateScrollTo(y:number, options)\n  animateScrollTo([x:number | null, y:number | null], options)\n  animateScrollTo(scrollToElement:Element, options)";s=null===e[0]?c.getHorizontalScroll():e[0],n=null===e[1]?c.getVerticalScroll():e[1]}return s+=a.horizontalOffset,n+=a.verticalOffset,u=c.getMaxHorizontalScroll(),h=c.getHorizontalScroll(),s>u&&(s=u),d=s-h,f=c.getMaxVerticalScroll(),p=c.getVerticalScroll(),n>f&&(n=f),m=n-p,g=Math.abs(Math.round(d/1e3*a.speed)),v=Math.abs(Math.round(m/1e3*a.speed)),(y=g>v?g:v)<a.minDuration?y=a.minDuration:y>a.maxDuration&&(y=a.maxDuration),[2,new Promise((function(e,t){var l;0===d&&0===m&&e(!0),Ve.remove(a.elementToScroll,!0);var r=function(){f(),cancelAnimationFrame(l),e(!1)};Ve.add(a.elementToScroll,r);var o=a.cancelOnUserAction?r:function(e){return e.preventDefault()},i=a.cancelOnUserAction?{passive:!0}:{passive:!1},u=["wheel","touchstart","keydown","mousedown"],f=function(){u.forEach((function(e){a.elementToScroll.removeEventListener(e,o,i)}))};u.forEach((function(e){a.elementToScroll.addEventListener(e,o,i)}));var g=Date.now(),v=function(){var t=Date.now()-g,r=t/y,o=Math.round(h+d*a.easing(r)),i=Math.round(p+m*a.easing(r));t<y&&(o!==s||i!==n)?(c.scrollTo(o,i),l=requestAnimationFrame(v)):(c.scrollTo(s,n),cancelAnimationFrame(l),f(),Ve.remove(a.elementToScroll,!1),e(!0))};l=requestAnimationFrame(v)}))]}))}))};const $e={mounted:(e,t,s,n)=>{const l=t=>{0===e.horizontalScrollDirective.sumDelta&&(e.horizontalScrollDirective.startLeft=e.scrollLeft),e.horizontalScrollDirective.sumDelta-=t.deltaY;const s=e.scrollWidth-e.clientWidth,n=Math.min(s,Math.max(0,e.horizontalScrollDirective.startLeft-e.horizontalScrollDirective.sumDelta));We([n,null],{elementToScroll:e}).then((t=>{t&&(e.horizontalScrollDirective.sumDelta=0)})),e.scrollWidth!=e.clientWidth&&t.preventDefault()};e.addEventListener("wheel",l),e.horizontalScrollDirective={sumDelta:0,startLeft:0,onUnbind:()=>{e.removeEventListener("wheel",l)}}},beforeUnmount:(e,t,s,n)=>{e.horizontalScrollDirective.onUnbind()}};var Xe=x,Ke=b;var Ye=function(e,t){for(var s=-1,n=null==e?0:e.length,l=Array(n);++s<n;)l[s]=t(e[s],s,e);return l},Je=S,Qe=function(e){return"symbol"==typeof e||Ke(e)&&"[object Symbol]"==Xe(e)},Ze=_?_.prototype:void 0,et=Ze?Ze.toString:void 0;var tt=function e(t){if("string"==typeof t)return t;if(Je(t))return Ye(t,e)+"";if(Qe(t))return et?et.call(t):"";var s=t+"";return"0"==s&&1/t==-Infinity?"-0":s};var st=function(e,t,s){var n=-1,l=e.length;t<0&&(t=-t>l?0:l+t),(s=s>l?l:s)<0&&(s+=l),l=t>s?0:s-t>>>0,t>>>=0;for(var a=Array(l);++n<l;)a[n]=e[n+t];return a};var nt=function(e,t,s){var n=e.length;return s=void 0===s?n:s,!t&&s>=n?e:st(e,t,s)},lt=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");var at=function(e){return lt.test(e)},rt=M,ot=T,it=P,ct=D;var ut=function(e,t,s){if(!ct(s))return!1;var n=typeof t;return!!("number"==n?ot(s)&&it(t,s.length):"string"==n&&t in s)&&rt(s[t],e)},ht=x,dt=b;var ft=function(e){return dt(e)&&"[object RegExp]"==ht(e)},pt=A,mt=H.exports,gt=mt&&mt.isRegExp,vt=gt?pt(gt):ft;var yt=function(e){return e.split("")},kt="[\\ud800-\\udfff]",wt="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",Ct="\\ud83c[\\udffb-\\udfff]",xt="[^\\ud800-\\udfff]",bt="(?:\\ud83c[\\udde6-\\uddff]){2}",_t="[\\ud800-\\udbff][\\udc00-\\udfff]",St="(?:"+wt+"|"+Ct+")"+"?",Mt="[\\ufe0e\\ufe0f]?"+St+("(?:\\u200d(?:"+[xt,bt,_t].join("|")+")[\\ufe0e\\ufe0f]?"+St+")*"),Tt="(?:"+[xt+wt+"?",wt,bt,_t,kt].join("|")+")",Pt=RegExp(Ct+"(?="+Ct+")|"+Tt+Mt,"g");var Dt=yt,Ht=at,At=function(e){return e.match(Pt)||[]};var It=tt;var Et=tt,Ut=nt,Rt=at,zt=ut,jt=vt,Ot=function(e){return Ht(e)?At(e):Dt(e)},Lt=function(e){return null==e?"":It(e)};var Bt=function(e,t,s){return s&&"number"!=typeof s&&zt(e,t,s)&&(t=s=void 0),(s=void 0===s?4294967295:s>>>0)?(e=Lt(e))&&("string"==typeof t||null!=t&&!jt(t))&&!(t=Et(t))&&Rt(e)?Ut(Ot(e),0,s):e.split(t,s):[]};const Ft={updated:(e,t)=>{var s,n;if((null==(s=null==e?void 0:e.typerDirective)?void 0:s.oldValue)!==t.value){null==(n=null==e?void 0:e.typerDirective)||n.free();let s=null;const l=()=>{null!==s&&(clearInterval(s),s=null)};e.innerHTML="";const a=Bt(t.value,"");s=setInterval((()=>{a.length?e.innerHTML+=a.shift():l()}),7),e.typerDirective={free:l,oldValue:t.value}}},beforeUnmount:(e,t,s,n)=>{var l;null==(l=null==e?void 0:e.typerDirective)||l.free()}},Nt={mounted:(e,t)=>{let s=null;e.style.opacity="1",s=setTimeout((()=>{e.style.opacity=""}),+t.value||1e3),e.opacityDelayDirective={free:()=>{null!==s&&(clearTimeout(s),s=null)}}},beforeUnmount:(e,t,s,n)=>{e.opacityDelayDirective.free()}},Vt={mounted:(e,t,s)=>{const n=t=>{if(e!=t.target&&!e.contains(t.target)){console.log(t);let s=0;e.style.opacity=".2";const n=setInterval((()=>{s<3?(e.style.opacity=s%2!=0?".2":"1",s++):(e.style.opacity="",clearInterval(n))}),200)}};document.body.addEventListener("click",n);e.clickOutsideDirective={free:()=>{document.body.removeEventListener("click",n)}}},beforeUnmount:(e,t,s,n)=>{e.clickOutsideDirective.free()}};class Gt{constructor(e){this.agent=e,this.hand=[],this._stacks=[[],[],[],[],[],[]],this.current=e instanceof Ue,this.setStacks=this.agent.setStacks.bind(this.agent)}get stacks(){return this._stacks}set myHero(e){this._myHero=e}get myHero(){return this._myHero}async selectCard(e){const t=await this.agent.selectCard(e);return this.hand.push(e[t]),this.agent.setHand(this.hand),t}get stacksNoDefects(){let e=[];for(let t=0;t<6;t++)0!==this.stacks[t].length&&p[this.stacks[t][this.stacks[t].length-1]].type===E.Defect||e.push(t);return e}get stacksNoDefectsNoEmpty(){let e=[];for(let t=0;t<6;t++)0!==this.stacks[t].length&&p[this.stacks[t][this.stacks[t].length-1]].type!==E.Defect&&e.push(t);return e}get stacksDefects(){let e=[];for(let t=0;t<6;t++)this.stacks[t].length>0&&p[this.stacks[t][this.stacks[t].length-1]].type===E.Defect&&e.push(t);return e}async scrapRequest(e){if(e===E.Fire||e===E.Metal){let e=this.stacksDefects;if(e.length>0){const t=e[(await this.agent.selectStacks(e,1))[0]];this.stacks[t].pop()}}else if(e===E.Electro||e===E.Computer){const e=this.stacksNoDefectsNoEmpty;if(e.length>=2){const t=this.stacksNoDefects,s=e[(await this.agent.selectStacks(e,1))[0]],n=t[(await this.agent.selectStacks(t,1))[0]];let l=this.stacks[s];this.stacks[s]=this.stacks[n],this.stacks[n]=l}}}async programming(){for(this.agent.setStacks(this.stacks),this.agent.setHand(this.hand);this.hand.length>0;){const e=[-2,-1,...this.stacksNoDefects],[t,s]=await this.agent.programming(e),n=e[s];if(-2===n)this.hand.splice(t,1);else if(-1===n)await this.scrapRequest(p[this.hand[t]].type),this.hand.splice(t,1);else if(0===this.stacks[n].length||p[this.stacks[n][0]].type===p[this.hand[t]].type){if(3===this.stacks[n].length){for(let e=1;e<3;e++)this.stacks[n][e-1]=this.stacks[n][e];this.stacks[n].pop()}this.stacks[n].push(this.hand[t]),this.hand.splice(t,1)}else this.stacks[n]=[this.hand[t]],this.hand.splice(t,1);this.agent.setStacks(this.stacks),this.agent.setHand(this.hand)}}async chooseRotate(e,t){return await this.agent.chooseRotate(e,t)}async selectCells(e,t,s){return this.agent.selectCells(e,t,s)}}class qt extends Ee{constructor(e,t,s){super(),this.network=e,this.id=t,this.seed=s,this.reserveBotAgent=null,this.chooseRotate=this.handlerFactory("chooseRotate"),this.programming=this.handlerFactory("programming"),this.selectCard=this.handlerFactory("selectCard"),this.selectCells=this.handlerFactory("selectCells"),this.selectStacks=this.handlerFactory("selectStacks"),this.setStacks=()=>{},this.setHand=()=>{}}reserveAgent(e,...t){null!=this.reserveBotAgent||(this.reserveBotAgent=new Re(this.seed));const s=this.reserveBotAgent[e](...t);return console.log("reserveAgent",s),s}handlerFactory(e){return(...t)=>this.network.waitAction(this.id,e).then((s=>null!=s?s:this.reserveAgent(e,...t)))}}class Wt extends class{}{constructor(e,t){super(),this.roomId=e,this.emitter=t,this.resultsCallbacks={},this.results={},this.openId=null,this.leaversIds=new Set,this.listenerThis=this.receiveAction.bind(this),this.gameEventName=["room",this.roomId,"game"]}async sendAction(e,t){await this.emitter.emit(this.gameEventName,{name:e,payload:t})}receiveAction({type:e,id:t,data:s}){t!==this.openId&&("data"===e?(console.log("receiveAction",t,s.name,s.payload),this.pushResult(t,s.name,s.payload)):"off"===e&&(this.resultsCallbacks[t]&&Object.entries(this.resultsCallbacks[t]).forEach((([e,t])=>t.forEach((e=>e(null))))),this.leaversIds.add(t)))}async init(){this.openId=await this.emitter.on(this.gameEventName,this.listenerThis)}destroy(){this.emitter.off(this.gameEventName,this.listenerThis)}pushResult(e,t,s){var n,l,a,r,o,i;const c=null!=(r=null==(a=null==(l=null==(n=this.resultsCallbacks)?void 0:n[e])?void 0:l[t])?void 0:a.shift())?r:null;c?c(s):(null!=(o=this.results)[e]||(o[e]={}),null!=(i=this.results[e])[t]||(i[t]=[]),this.results[e][t].push(s))}async getResult(e,t){return new Promise(((s,n)=>{var l,a,r,o,i,c;const u=null!=(o=null==(r=null==(a=null==(l=this.results)?void 0:l[e])?void 0:a[t])?void 0:r.shift())?o:null;u?s(u):(null!=(i=this.resultsCallbacks)[e]||(i[e]={}),null!=(c=this.resultsCallbacks[e])[t]||(c[t]=[]),this.resultsCallbacks[e][t].push(s))}))}async waitAction(e,t){return console.log("waitAction",{fromId:e,actionName:t}),this.leaversIds.has(e)?null:await this.getResult(e,t)}}const $t=e=>{const t=F(null),s=[],n=()=>{const e=q(t).getBoundingClientRect().height;for(const t of s){const s=t.querySelector("."+pe.termCard),n=Math.min(0,e-s.getBoundingClientRect().height)+"px";s.style.top!==n&&(s.style.top=n)}};return N((()=>{n(),window.addEventListener("resize",n)})),V((()=>{window.removeEventListener("resize",n)})),{setItemTermSlotRef(e){s.push(e)},setItemTermPanelRef(e){t.value=e},rotateDirectionStyle:(e,t)=>`transform: rotate(${j(O(e,t))}deg)`,stackIsClickable(t){var s;return null==(s=e.stacksToClick.value)?void 0:s.has(t)},onStackClick(t){var s,n;null==(n=(s=e.onStackClick).value)||n.call(s,t)}}};var Xt=L({components:{SvgIcon:k,GameMapComponent:v,CardComponent:m},directives:{"horizontal-scroll":$e,typer:Ft,"opacity-delay":Nt,"click-outside":Vt},data:()=>({style:pe,cs:d}),methods:{directionToDeg:j,rotateDirection:O},setup(){const e=(()=>{const e=F(null),t=F([]),s=F(null),n=F(null),l=G(),a=F(""),r=F([]),o=F(null),i=F([]),c=F([[],[],[],[],[],[]]),u=F(null),h=F(new Map),d=F(null),f=F(null),m=F(""),g=F("0:00");let v=null;const y=F(0),k=F(0);return{render:{chooseRotate:(n,l)=>new Promise(((a,r)=>{t.value=n,s.value=l,e.value=n=>{e.value=null,s.value=null,t.value=[],a(n)}})),defeat:e=>{a.value="game.0",n.value={title:"game.1",text:e||"game.2",buttons:[{text:"game.3",handler:()=>l.push("/")}]}},win:()=>{a.value="game.0",n.value={title:"game.4",text:"game.5",buttons:[{text:"game.3",handler:()=>l.push("/")}]}},error:e=>{a.value="game.0",n.value={title:"game.6",text:e,buttons:[{text:"game.3",handler:()=>l.push("/")}]}},hideMessage:()=>{a.value=""},selectCard:e=>new Promise(((t,s)=>{r.value=e,o.value=e=>{o.value=null,r.value=[],t(e)}})),setHand:e=>{i.value=e},showMessage:e=>{a.value=e},setStacks:e=>{c.value=I(e)},selectStacks:(e,t)=>new Promise(((s,n)=>{e.forEach(((e,t)=>h.value.set(e,t)));const l=[];u.value=e=>{const n=h.value.get(e);l.push(n),l.length===t&&(h.value.clear(),u.value=null,s(l))}})),programming:e=>new Promise((async(t,s)=>{d.value=s=>{f.value=s===f.value?null:s,null!==f.value?(m.value={[E.Electro]:"move",[E.Computer]:"move",[E.Fire]:"fix",[E.Metal]:"fix"}[p[i.value[f.value]].type],e.forEach(((e,t)=>h.value.set(e,t))),u.value=e=>{const s=h.value.get(e);u.value=null,d.value=null;const n=f.value;h.value.clear(),f.value=null,m.value="",t([n,s])}):(m.value="",h.value.clear(),u.value=null)}})),startTimer:e=>{let t=new Date(0,0,0,0,0,0);const s=()=>{t=new Date(t.getTime()+1e3),g.value=t.toLocaleTimeString(void 0,{minute:"numeric",second:"2-digit"})};s(),v=setInterval(s,1e3)},stopTimer:()=>{null!==v&&(clearInterval(v),v=null),g.value="0:00"},stopSelect:()=>{e.value=null,o.value=null,u.value=null,d.value=null},updateBombCounter:e=>{y.value=e},updateKillsCounter:e=>{k.value=e}},onRotationClick:e,rotationsSelect:t,rotationsSelectCurrentDirection:s,message:a,selectsCards:r,onCardClick:o,handCards:i,stacks:c,popupMessage:n,onStackClick:u,stacksToClick:h,onHandClick:d,handActiveCardInd:f,scrapType:m,time:g,heart:y,creep:k}})(),{render:t}=e,s=r(e,["render"]),n=(()=>{const e=F(null),t=F(new Map),s=F(null),n=new Map,l=F(new Map);let a=0;const r=F(new Map),o={initUnit:e=>{var t;const s={[R.Creep]:"greenSlime",[R.Bomb]:"cake",[R.Hero]:n.get(null==(t=e.unit)?void 0:t.ownerUser)},r={cell:e,key:a++,skin:s[e.unit.type],state:"idle"};l.value.set(e.unit,r)},killUnit:e=>{l.value.delete(e.unit)},moveUnit:(e,t)=>new Promise((s=>{const n=l.value.get(e);n.cell=t,n.state="walk",setTimeout((()=>{n.state="idle",s()}),500)})),updateHeroDirection:(e,t)=>{r.value.set(e.unit,t)},renderMap:e=>{s.value=e},selectCells:(s,n,l)=>new Promise(((a,r)=>{for(let e=0;e<s.length;e++)t.value.set(s[e],{highlight:n,ind:e});const o=[];e.value=s=>{const n=t.value.get(s);if(n){t.value.delete(s);const{ind:r,highlight:i}=n;o.push(r),o.length===l&&(e.value=null,t.value.clear(),a(o))}}}))};return{skins:n,render:o,onCellClick:e,cellsToSelect:t,gameMap:s,units:l,cellsDirection:r,moveUnitMs:500}})(),{render:l,skins:o}=n,i=r(n,["render","skins"]);return((e,t)=>{const s=q(W(f));let{room:n}=s;const l=G(),a=$();let r=null;N((async()=>{if(!n)if(void 0!==a.query.testJoin){n=new ue;let e=localStorage.getItem("roomNameTest");n.setCurrentPlayerData({skin:"ame",name:"ame"}),await n.joinRoom(e),await new Promise((e=>n.on("players",e)))}else{if(void 0===a.query.testCreate)return void(await l.push("/"));{n=new ue,n.setCurrentPlayerData({skin:"gura",name:"gura"});let e=await n.openRoom();localStorage.setItem("roomNameTest",e),await new Promise((e=>n.on("players",e)))}}const s=n.players.sort(he("selfId")),o=s.map((e=>e.selfId)).join("/"),i=new y([[1,0,0,0,0,2,2,0,0,0,0,0],[1,1,0,0,0,0,0,2,0,2,2,0],[1,1,1,0,0,0,0,0,0,0,0,0],[1,1,1,0,0,0,0,2,0,3,0,2],[1,1,0,0,0,0,0,2,0,0,2,0],[1,0,0,0,0,2,0,0,0,0,0,0]]);for(const e of s)e.selfId!==n.player.selfId&&e.selfId===e.ownerId&&(r||(r=new Wt(await n.openRoom(),new de(fe,n.player.selfId)),await r.init()));const c=s.map((s=>{const l=s.selfId===n.player.selfId?new Ue(r,n.player.selfId,q(e)):s.selfId===s.ownerId?new qt(r,s.selfId,o):new Re(o),a=new Gt(l);return t.set(a,s.data.skin),a}));new Ie(q(e),c,i,o,c[0]).start(),e.startTimer(0)})),V((()=>{null==r||r.destroy()}))})(a(a({},t),l),o),{game:B(s),map:B(i),visual:$t(s)}}});const Kt={style:{visibility:"hidden"}},Yt=["disabled"],Jt=["disabled"],Qt=["disabled","onClick"],Zt=["disabled","onClick"],es=["onClick"],ts=["onClick"],ss=["onClick"];Xt.render=function(e,t,s,n,l,a){var r,o,i;const c=X("router-link"),u=X("SvgIcon"),h=X("GameMapComponent"),d=X("CardComponent"),f=K("typer"),p=K("click-outside"),m=K("opacity-delay"),g=K("horizontal-scroll");return Y(),J("div",{class:Z([e.cs.ctn,e.style.ctn]),ref:"ctn"},[Q("div",{class:Z(e.style.header)},[Q("div",{class:Z(e.style.headerLinks)},null,2),Q("div",{class:Z(e.style.headerMessage)},[Q("div",{class:Z(e.style.headerMessageText)},[Q("div",{class:Z(e.style.headerMessageTextCtn)},[Q("span",Kt,ee(e.$t(e.game.message)),1),te(Q("span",{class:Z(e.style.headerMessageTextRepeat)},null,2),[[f,e.$t(e.game.message)]])],2)],2)],2),Q("div",{class:Z(e.style.headerLinks)},[se(c,{target:"_blank",to:"/rules",class:Z(e.style.headerLink)},{default:ne((()=>[le(ee(e.$t("pages.game.7310")),1)])),_:1},8,["class"]),se(c,{target:"_blank",to:"/",class:Z(e.style.headerLink)},{default:ne((()=>[le(ee(e.$t("pages.game.8708")),1)])),_:1},8,["class"])],2)],2),Q("div",{class:Z(e.style.statsPanelCtn)},[Q("div",{class:Z(e.style.statsPanel)},[(Y(),J(ae,null,re(["creep","heart","time"],(t=>Q("div",{class:Z([e.style.statCtn,e.style.statCtnCounter])},[se(u,{class:Z(e.style.statIcon),name:t},null,8,["class","name"]),Q("div",{class:Z([e.style.statValue])},ee(e.game[t]),3)],2))),64)),Q("button",{type:"button",disabled:!e.visual.stackIsClickable(-1),class:Z([e.style.statCtn,e.style.statCtnCrane]),onClick:t[0]||(t[0]=t=>e.visual.stackIsClickable(-1)&&e.visual.onStackClick(-1))},["fix"===e.game.scrapType?(Y(),oe(u,{key:0,class:Z(e.style.statIcon),name:"fix"},null,8,["class"])):"move"===e.game.scrapType?(Y(),oe(u,{key:1,class:Z(e.style.statIcon),name:"cranMove"},null,8,["class"])):(Y(),oe(u,{key:2,class:Z(e.style.statIcon),name:"cran"},null,8,["class"]))],10,Yt),Q("button",{type:"button",disabled:!e.visual.stackIsClickable(-1),class:Z([e.style.statCtn,e.style.statCtnTrash]),onClick:t[1]||(t[1]=t=>e.visual.stackIsClickable(-2)&&e.visual.onStackClick(-2))},[se(u,{class:Z(e.style.statIcon),name:"trash"},null,8,["class"])],10,Jt),Q("div",{class:Z([e.style.statCtn,e.style.statCtnDirection])},[se(u,{class:Z(e.style.statIcon),name:"direction"},null,8,["class"])],2)],2)],2),Q("div",{class:Z(e.style.gamePanel)},[e.map.gameMap?(Y(),oe(h,{key:0,renderMap:e.map},null,8,["renderMap"])):ie("",!0)],2),Q("div",{class:Z(e.style.handPanelCtn)},[Q("div",{class:Z(e.style.handPanel)},[(Y(!0),J(ae,null,re(e.game.handCards,((t,s)=>(Y(),J("button",{type:"button",disabled:!e.game.onHandClick,class:Z(e.style.handPanelCard),onClick:t=>{var n,l;return null==(l=(n=e.game).onHandClick)?void 0:l.call(n,s)}},[se(d,{idx:t,select:!!e.game.onHandClick,active:e.game.handActiveCardInd===s},null,8,["idx","select","active"])],10,Qt)))),256))],2)],2),Q("div",{class:Z(e.style.termPanel),ref:e.visual.setItemTermPanelRef},[(Y(!0),J(ae,null,re(e.game.stacks,((t,s)=>(Y(),J("div",{class:Z(e.style.termSlot),ref:e.visual.setItemTermSlotRef},[Q("button",{type:"button",disabled:!e.visual.stackIsClickable(s),class:Z(e.style.termCard),onClick:t=>e.visual.onStackClick(s)},[se(d,{stack:t,select:e.visual.stackIsClickable(s)},null,8,["stack","select"]),Q("div",{class:Z([e.style.termGradient,{[e.style.termGradient_select]:e.visual.stackIsClickable(s),[e.style.termGradient_empty]:!t.length}])},null,2)],10,Zt)],2)))),256))],2),e.game.selectsCards.length?te((Y(),J("div",{key:0,class:Z(e.style.selectPopupCtn)},[Q("div",{class:Z(e.style.selectPopup)},[(Y(!0),J(ae,null,re(e.game.selectsCards,((t,s)=>(Y(),J("button",{type:"button",disabled:!1,class:Z(e.style.selectPopupCard),onClick:t=>{var n,l;return null==(l=null==(n=e.game)?void 0:n.onCardClick)?void 0:l.call(n,s)}},[se(d,{idx:t,select:!0},null,8,["idx"])],10,es)))),256))],2)],2)),[[p],[m],[g]]):ie("",!0),e.game.rotationsSelect.length?te((Y(),J("div",{key:1,class:Z(e.style.directionPopupCtn)},[Q("div",{class:Z(e.style.directionPopup)},[Q("div",{class:Z(e.style.directionPopupTitle)},ee(e.$t("pages.game.7101")),3),Q("div",{class:Z(e.style.directionPopupChoose)},[(Y(!0),J(ae,null,re(e.game.rotationsSelect,((t,s)=>(Y(),J("button",{type:"button",class:Z(e.style.directionPopupDirection),onClick:t=>{var n,l;return null==(l=null==(n=e.game)?void 0:n.onRotationClick)?void 0:l.call(n,s)}},[se(u,{style:ce(e.visual.rotateDirectionStyle(e.game.rotationsSelectCurrentDirection,t)),name:"direction",class:Z(e.style.directionPopupIcon)},null,8,["style","class"])],10,ts)))),256))],2)],2)],2)),[[p],[m]]):ie("",!0),e.game.popupMessage?(Y(),J("div",{key:2,class:Z(e.style.messagePopupCtn)},[Q("div",{class:Z(e.style.messagePopup)},[Q("div",{class:Z(e.style.messagePopupTitle)},ee(e.$t(null==(r=e.game.popupMessage)?void 0:r.title)),3),Q("div",{class:Z(e.style.messagePopupText)},ee(e.$t(null==(o=e.game.popupMessage)?void 0:o.text)),3),(Y(!0),J(ae,null,re(null==(i=e.game.popupMessage)?void 0:i.buttons,(({text:t,handler:s})=>(Y(),J("button",{type:"button",class:Z(e.style.messagePopupButton),onClick:s},ee(e.$t(t)),11,ss)))),256))],2)],2)):ie("",!0)],2)};export{Xt as default};
